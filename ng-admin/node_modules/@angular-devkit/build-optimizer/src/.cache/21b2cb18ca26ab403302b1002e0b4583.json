{"remainingRequest":"D:\\mygit\\HCWeChat\\ng-admin\\node_modules\\@angular-devkit\\build-optimizer\\src\\build-optimizer\\webpack-loader.js??ref--3-1!D:\\mygit\\HCWeChat\\ng-admin\\node_modules\\@delon\\theme\\services\\menu\\menu.service.js","dependencies":[{"path":"D:\\mygit\\HCWeChat\\ng-admin\\node_modules\\@delon\\theme\\services\\menu\\menu.service.js","mtime":1515671330000},{"path":"D:\\mygit\\HCWeChat\\ng-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":0},{"path":"D:\\mygit\\HCWeChat\\ng-admin\\node_modules\\@angular-devkit\\build-optimizer\\src\\build-optimizer\\webpack-loader.js","mtime":1519266497000}],"contextDependencies":[],"result":["import { Injectable, Inject, Optional } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs/BehaviorSubject';\nimport { share } from 'rxjs/operators';\nimport { ALAIN_I18N_TOKEN } from '../i18n/i18n';\nimport { ACLService } from '@delon/acl';\nvar MenuService = /*@__PURE__*/ (function () {\n    function MenuService(i18nService, aclService) {\n        this.i18nService = i18nService;\n        this.aclService = aclService;\n        this._change$ = new BehaviorSubject([]);\n        this.data = [];\n    }\n    Object.defineProperty(MenuService.prototype, \"change\", {\n        get: function () {\n            return this._change$.pipe(share());\n        },\n        enumerable: true,\n        configurable: true\n    });\n    MenuService.prototype.visit = function (callback) {\n        var inFn = function (list, parentMenu, depth) {\n            for (var _i = 0, list_1 = list; _i < list_1.length; _i++) {\n                var item = list_1[_i];\n                callback(item, parentMenu, depth);\n                if (item.children && item.children.length > 0) {\n                    inFn(item.children, item, depth + 1);\n                }\n                else {\n                    item.children = [];\n                }\n            }\n        };\n        inFn(this.data, null, 0);\n    };\n    MenuService.prototype.add = function (items) {\n        (_a = this.data).push.apply(_a, items);\n        this.resume();\n        var _a;\n    };\n    /**\n     * 重置菜单，可能I18N、用户权限变动时需要调用刷新\n     */\n    /**\n         * 重置菜单，可能I18N、用户权限变动时需要调用刷新\n         */\n    MenuService.prototype.resume = /**\n         * 重置菜单，可能I18N、用户权限变动时需要调用刷新\n         */\n        function (callback) {\n            var _this = this;\n            var i = 1;\n            this.removeShortcut();\n            var shortcuts = [];\n            this.visit(function (item, parent, depth) {\n                item.__id = i++;\n                item.__parent = parent;\n                item._depth = depth;\n                if (!item.link)\n                    item.link = '';\n                if (!item.externalLink)\n                    item.externalLink = '';\n                // badge\n                if (item.badge) {\n                    if (item.badge_dot !== true) {\n                        item.badge_dot = false;\n                    }\n                    if (!item.badge_status) {\n                        item.badge_status = 'error';\n                    }\n                }\n                item._type = item.externalLink ? 2 : 1;\n                if (item.children && item.children.length > 0) {\n                    item._type = 3;\n                }\n                // shortcut\n                if (item.shortcut === true && (item.link || item.externalLink))\n                    shortcuts.push(item);\n                var i18n = item.i18n || item.translate;\n                item.text = _this.i18nService && i18n ? _this.i18nService.fanyi(i18n) : item.text;\n                // hidden\n                item._hidden = typeof item.hide === 'undefined' ? false : item.hide;\n                // acl\n                if (item.acl && _this.aclService) {\n                    item._hidden = !_this.aclService.can(item.acl);\n                }\n                if (callback)\n                    callback(item, parent, depth);\n            });\n            this.loadShortcut(shortcuts);\n            this._change$.next(this.data);\n        };\n    /**\n     * 加载快捷菜单，加载位置规则如下：\n     * 1、统一在下标0的节点下（即【主导航】节点下方）\n     *      1、若 children 存在 【shortcut_root: true】则最优先【推荐】这种方式\n     *      2、否则查找带有【dashboard】字样链接，若存在则在此菜单的下方创建快捷入口\n     *      3、否则放在0节点位置\n     */\n    /**\n         * 加载快捷菜单，加载位置规则如下：\n         * 1、统一在下标0的节点下（即【主导航】节点下方）\n         *      1、若 children 存在 【shortcut_root: true】则最优先【推荐】这种方式\n         *      2、否则查找带有【dashboard】字样链接，若存在则在此菜单的下方创建快捷入口\n         *      3、否则放在0节点位置\n         */\n    MenuService.prototype.loadShortcut = /**\n         * 加载快捷菜单，加载位置规则如下：\n         * 1、统一在下标0的节点下（即【主导航】节点下方）\n         *      1、若 children 存在 【shortcut_root: true】则最优先【推荐】这种方式\n         *      2、否则查找带有【dashboard】字样链接，若存在则在此菜单的下方创建快捷入口\n         *      3、否则放在0节点位置\n         */\n        function (shortcuts) {\n            if (shortcuts.length === 0 || this.data.length === 0)\n                return;\n            var ls = this.data[0].children || [];\n            var pos = ls.findIndex(function (w) { return w.shortcut_root === true; });\n            if (pos === -1) {\n                pos = ls.findIndex(function (w) { return w.link.includes('dashboard') || w.externalLink.includes('dashboard'); });\n                pos = (pos !== -1 ? pos : -1) + 1;\n                this.data[0].children.splice(pos, 0, {\n                    text: '快捷菜单',\n                    translate: 'shortcut',\n                    icon: 'icon-rocket',\n                    children: []\n                });\n            }\n            var _data = this.data[0].children[pos];\n            _data = Object.assign(_data, {\n                shortcut_root: true,\n                _type: 3,\n                __id: -1,\n                _depth: 1\n            });\n            _data.children = shortcuts.map(function (i) {\n                i._depth = 2;\n                return i;\n            });\n        };\n    MenuService.prototype.removeShortcut = function () {\n        var ls = this.data && this.data.length && this.data[0].children || [];\n        var pos = ls.findIndex(function (w) { return w.shortcut_root === true; });\n        if (pos !== -1)\n            ls.splice(pos, 1);\n    };\n    Object.defineProperty(MenuService.prototype, \"menus\", {\n        get: function () {\n            return this.data;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    /**\n     * 清空菜单\n     */\n    /**\n         * 清空菜单\n         */\n    MenuService.prototype.clear = /**\n         * 清空菜单\n         */\n        function () {\n            this.data = [];\n            this._change$.next(this.data);\n        };\n    /**\n     * 根据URL设置菜单 `_open` 属性\n     * @param url URL地址\n     */\n    /**\n         * 根据URL设置菜单 `_open` 属性\n         * @param url URL地址\n         */\n    MenuService.prototype.openedByUrl = /**\n         * 根据URL设置菜单 `_open` 属性\n         * @param url URL地址\n         */\n        function (url) {\n            if (!url) {\n                return;\n            }\n            var findItem = null;\n            this.visit(function (item) {\n                item._open = false;\n                if (!item.link) {\n                    return;\n                }\n                if (!findItem && url.startsWith(item.link)) {\n                    findItem = item;\n                }\n            });\n            if (!findItem) {\n                console.warn(\"not found page name: \" + url);\n                return;\n            }\n            do {\n                findItem._open = true;\n                findItem = findItem.__parent;\n            } while (findItem);\n        };\n    /**\n     * 根据url获取菜单列表\n     * @param url\n     */\n    /**\n         * 根据url获取菜单列表\n         * @param url\n         */\n    MenuService.prototype.getPathByUrl = /**\n         * 根据url获取菜单列表\n         * @param url\n         */\n        function (url) {\n            var item = null;\n            this.visit(function (i, parent, depth) {\n                if (i.link === url) {\n                    item = i;\n                }\n            });\n            var ret = [];\n            if (!item)\n                return ret;\n            do {\n                ret.splice(0, 0, item);\n                item = item.__parent;\n            } while (item);\n            return ret;\n        };\n    MenuService.prototype.ngOnDestroy = function () {\n        if (this._change$)\n            this._change$.unsubscribe();\n    };\n    return MenuService;\n}());\nexport { MenuService };\n//# sourceMappingURL=menu.service.js.map \n",null]}