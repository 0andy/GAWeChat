{"remainingRequest":"D:\\mygit\\HCWeChat\\ng-admin\\node_modules\\@angular-devkit\\build-optimizer\\src\\build-optimizer\\webpack-loader.js??ref--3-1!D:\\mygit\\HCWeChat\\ng-admin\\node_modules\\@delon\\abc\\charts\\timeline\\timeline.component.js","dependencies":[{"path":"D:\\mygit\\HCWeChat\\ng-admin\\node_modules\\@delon\\abc\\charts\\timeline\\timeline.component.js","mtime":1515671330000},{"path":"D:\\mygit\\HCWeChat\\ng-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":0},{"path":"D:\\mygit\\HCWeChat\\ng-admin\\node_modules\\@angular-devkit\\build-optimizer\\src\\build-optimizer\\webpack-loader.js","mtime":1519266497000}],"contextDependencies":[],"result":["import { Component, Input, ViewChild, TemplateRef, ChangeDetectionStrategy, ChangeDetectorRef } from '@angular/core';\nimport { coerceNumberProperty } from '@angular/cdk/coercion';\nvar TimelineComponent = /*@__PURE__*/ (function () {\n    function TimelineComponent(cd) {\n        this.cd = cd;\n        // region: fields\n        this._title = '';\n        this.colorMap = { y1: '#1890FF', y2: '#2FC25B' };\n        this._height = 400;\n        this.padding = [60, 20, 40, 40];\n        this._borderWidth = 2;\n        this.initFlag = false;\n    }\n    Object.defineProperty(TimelineComponent.prototype, \"title\", {\n        set: function (value) {\n            if (value instanceof TemplateRef)\n                this._titleTpl = value;\n            else\n                this._title = value;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(TimelineComponent.prototype, \"height\", {\n        get: function () { return this._height; },\n        set: function (value) {\n            this._height = coerceNumberProperty(value);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(TimelineComponent.prototype, \"borderWidth\", {\n        get: function () { return this._borderWidth; },\n        set: function (value) {\n            this._borderWidth = coerceNumberProperty(value);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    TimelineComponent.prototype.ngOnInit = function () {\n        var _this = this;\n        this.initFlag = true;\n        setTimeout(function () { return _this.install(); }, 200);\n    };\n    TimelineComponent.prototype.install = function () {\n        if (!this.data || (this.data && this.data.length < 1))\n            return;\n        // clean\n        this.sliderNode.nativeElement.innerHTML = '';\n        this.node.nativeElement.innerHTML = '';\n        var MAX = 8;\n        var begin = this.data.length > MAX ? (this.data.length - MAX) / 2 : 0;\n        var ds = new DataSet({\n            state: {\n                start: this.data[begin - 1].x,\n                end: this.data[begin - 1 + MAX].x\n            }\n        });\n        var dv = ds.createView().source(this.data);\n        dv.source(this.data).transform({\n            type: 'filter',\n            callback: function (obj) {\n                var time = new Date(obj.x).getTime(); // !注意：时间格式，建议转换为时间戳进行比较\n                return time >= ds.state.start && time <= ds.state.end;\n            }\n        });\n        var chart = new G2.Chart({\n            container: this.node.nativeElement,\n            forceFit: true,\n            height: +this.height,\n            padding: this.padding\n        });\n        chart.axis('x', { title: false });\n        chart.axis('y1', {\n            title: false\n        });\n        chart.axis('y2', false);\n        var max;\n        if (this.data[0] && this.data[0].y1 && this.data[0].y2) {\n            max = Math.max(this.data.sort(function (a, b) { return b.y1 - a.y1; })[0].y1, this.data.sort(function (a, b) { return b.y2 - a.y2; })[0].y2);\n        }\n        chart.source(dv, {\n            x: {\n                type: 'timeCat',\n                tickCount: MAX,\n                mask: 'HH:MM',\n                range: [0, 1]\n            },\n            y1: {\n                alias: this.titleMap.y1,\n                max: max,\n                min: 0\n            },\n            y2: {\n                alias: this.titleMap.y2,\n                max: max,\n                min: 0\n            }\n        });\n        chart.legend({\n            position: 'top',\n            custom: true,\n            clickable: false,\n            items: [\n                { value: this.titleMap.y1, fill: this.colorMap.y1 },\n                { value: this.titleMap.y2, fill: this.colorMap.y2 }\n            ]\n        });\n        chart.line().position('x*y1').color(this.colorMap.y1).size(this.borderWidth);\n        chart.line().position('x*y2').color(this.colorMap.y2).size(this.borderWidth);\n        chart.render();\n        var sliderPadding = Object.assign([], this.padding);\n        sliderPadding[0] = 0;\n        var slider = new Slider({\n            container: this.sliderNode.nativeElement,\n            height: 26,\n            padding: sliderPadding,\n            scales: {\n                x: {\n                    type: 'time',\n                    tickCount: 16,\n                    mask: 'HH:MM'\n                }\n            },\n            backgroundChart: {\n                type: 'line'\n            },\n            start: ds.state.start,\n            end: ds.state.end,\n            xAxis: 'x',\n            yAxis: 'y1',\n            data: this.data,\n            onChange: function (_a) {\n                var startValue = _a.startValue, endValue = _a.endValue;\n                ds.setState('start', startValue);\n                ds.setState('end', endValue);\n            }\n        });\n        slider.render();\n        this.chart = chart;\n        this.slider = slider;\n    };\n    TimelineComponent.prototype.uninstall = function () {\n        if (this.chart)\n            this.chart.destroy();\n        if (this.slider)\n            this.slider.destroy();\n    };\n    TimelineComponent.prototype.ngOnChanges = function (changes) {\n        if (this.initFlag)\n            this.install();\n    };\n    TimelineComponent.prototype.ngOnDestroy = function () {\n        this.uninstall();\n    };\n    return TimelineComponent;\n}());\nexport { TimelineComponent };\n//# sourceMappingURL=timeline.component.js.map \n",null]}